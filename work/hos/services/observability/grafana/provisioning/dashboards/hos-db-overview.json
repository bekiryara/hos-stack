{
  "uid": "hos-db-overview",
  "title": "H-OS DB Overview",
  "timezone": "browser",
  "schemaVersion": 39,
  "version": 1,
  "refresh": "10s",
  "tags": ["hos", "db", "postgres", "prometheus"],
  "panels": [
    {
      "type": "stat",
      "title": "Postgres exporter up",
      "gridPos": { "x": 0, "y": 0, "w": 8, "h": 4 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [{ "refId": "A", "expr": "up{job=\"postgres\"}" }],
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "colorMode": "value" }
    },
    {
      "type": "stat",
      "title": "pg_up",
      "gridPos": { "x": 8, "y": 0, "w": 8, "h": 4 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [{ "refId": "A", "expr": "pg_up" }],
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "colorMode": "value" }
    },
    {
      "type": "timeseries",
      "title": "Connections",
      "gridPos": { "x": 0, "y": 4, "w": 12, "h": 8 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        { "refId": "A", "expr": "pg_stat_activity_count" }
      ]
    },
    {
      "type": "timeseries",
      "title": "Transactions / sec",
      "gridPos": { "x": 12, "y": 4, "w": 12, "h": 8 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        { "refId": "A", "expr": "sum(rate(pg_stat_database_xact_commit[1m]))" },
        { "refId": "B", "expr": "sum(rate(pg_stat_database_xact_rollback[1m]))" }
      ]
    },
    {
      "type": "timeseries",
      "title": "Deadlocks (rate, 5m)",
      "gridPos": { "x": 0, "y": 12, "w": 12, "h": 8 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        { "refId": "A", "expr": "sum(rate(pg_stat_database_deadlocks{datname=\"hos\"}[5m]))" }
      ]
    },
    {
      "type": "timeseries",
      "title": "Cache hit ratio (%)",
      "gridPos": { "x": 12, "y": 12, "w": 12, "h": 8 },
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "refId": "A",
          "expr": "100 * (sum(rate(pg_stat_database_blks_hit{datname=\"hos\"}[5m])) / (sum(rate(pg_stat_database_blks_hit{datname=\"hos\"}[5m])) + sum(rate(pg_stat_database_blks_read{datname=\"hos\"}[5m]))))"
        }
      ]
    }
  ],
  "templating": { "list": [] },
  "annotations": { "list": [] }
}


