# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

### Added
- **PRODUCT MULTI-WORLD READ PATH PACK v2 (Food + Rentals + Self-Audit Gate)**: Completed Product read-path for all enabled worlds (commerce, food, rentals) with zero architecture drift. **A) MISSING CONTROLLERS**: Created `work/pazar/app/Http/Controllers/Api/Food/FoodListingController.php` and `work/pazar/app/Http/Controllers/Api/Rentals/RentalsListingController.php` mirroring Commerce ListingController patterns. Both controllers implement `index()` (tenant-scoped list with cursor pagination) and `show()` (tenant-scoped detail). Write methods (`store()`, `update()`, `destroy()`) return 501 NOT_IMPLEMENTED (stub). Enforce tenant boundary (`Listing::query()->forTenant($tenantId)`), world boundary (`->forWorld('food')` / `->forWorld('rentals')`), no cross-tenant leakage (404 NOT_FOUND for cross-tenant access). Use same response shape as Commerce (200: `{ ok:true, items:[...], cursor:{next:...} }` for index, 200: `{ ok:true, item:{...} }` for show). Error responses use standard envelope helpers. **B) ROUTES UPDATE**: Updated `work/pazar/routes/api.php` to use `FoodListingController` and `RentalsListingController` directly (removed aliases). **C) DOCUMENTATION**: Updated `docs/product/PRODUCT_API_SPINE.md` to mark food/rentals GET endpoints as IMPLEMENTED, updated controller references, explicitly state write endpoints remain 501 stubs. **D) SELF-AUDIT GATE**: Created `ops/product_read_path_check.ps1` - deterministic snapshot-driven gate that validates: enabled worlds from config, routes exist for each world (GET /api/v1/{world}/listings and GET /api/v1/{world}/listings/{id}), controller class files exist at expected paths, PHP syntax validation (php -l), optional live checks (if PRODUCT_TEST_TENANT_ID and PRODUCT_TEST_AUTH provided). Output table format (Check | Status | Notes). Exit codes: 0 PASS, 2 WARN (optional/live skipped), 1 FAIL (missing routes/controllers). Uses `ops/_lib/ops_output.ps1` for ASCII-only markers, `ops/_lib/ops_exit.ps1` for safe exit. **E) OPS STATUS INTEGRATION**: Updated `ops/ops_status.ps1` to include "Product Read Path Check" in check registry (after product_spine_e2e, optional=true). **F) PROOF**: Created `docs/PROOFS/product_multiworld_read_path_pass.md` with evidence items (files changed, guarantees preserved, acceptance examples). No schema changes, no refactors, no new runtime deps. Minimal diff, localized changes. PowerShell 5.1 compatible, ASCII-only output, safe exit behavior preserved.
- **V1 BACKBONE COMPLETION PACK v1 (WorldLock + API RequestId + Ops Self-Audit No-Exit + Commerce Read Fix)**: Implemented world context lock, API request ID guarantee, and ops script safe-exit behavior. **A) WORLD CONTEXT LOCK**: Created `work/pazar/app/Http/Middleware/WorldLock.php` middleware that validates world is enabled using `config('worlds.enabled')`, returns 404 with `WORLD_DISABLED` or `WORLD_INVALID` error if world is disabled/unknown, sets `ctx.world` and `world` attributes on request, adds `X-World` header to response. Registered `world.lock` alias in `work/pazar/bootstrap/app.php`. Applied `world.lock:commerce` middleware to Commerce routes in `work/pazar/routes/api.php` (before auth.any, resolve.tenant, tenant.user). **B) REQUEST ID GUARANTEE**: Added `RequestId` middleware to API stack in `work/pazar/bootstrap/app.php` (`$middleware->api(append: [\App\Http\Middleware\RequestId::class])`). RequestId middleware already sets `X-Request-Id` header on all responses (verified). **C) COMMERCE READ-PATH FIX**: Updated `work/pazar/app/Http/Controllers/Api/Commerce/ListingController.php` to handle missing `ctx.world` gracefully: if `ctx.world` is missing, default to "commerce" (defensive fallback), if `ctx.world` exists and != "commerce", return `WORLD_CONTEXT_INVALID` (400) with request_id. This prevents accidental 400s due to missing middleware while still enforcing world boundary. **D) OPS SELF-AUDIT NO-EXIT**: Replaced all hard `exit 0/1/2` statements in ops scripts with `Invoke-OpsExit 0/1/2` from `ops/_lib/ops_exit.ps1`. Updated scripts: `incident_bundle.ps1`, `auth_security_check.ps1`, `env_contract.ps1`, `routes_snapshot.ps1`, `security_audit.ps1`, `session_posture_check.ps1`, `slo_check.ps1`, `tenant_boundary_check.ps1`, `world_spine_check.ps1`, `request_trace.ps1`, `perf_baseline.ps1`, `alert_pipeline_proof.ps1`, `repo_integrity.ps1`, `ops_drift_guard.ps1`, `STACK_E2E_CRITICAL_TESTS_v1.ps1`, `STACK_E2E_CRITICAL_TESTS_v0.ps1`. All scripts now dot-source `ops/_lib/ops_exit.ps1` and use `Invoke-OpsExit` instead of hard exit. Replaced Unicode glyphs (❌, ✅, ✓, ➕, ➖) with ASCII markers ([FAIL], [PASS], [OK], [+], [-]) in `routes_snapshot.ps1` and `security_audit.ps1`. Interactive sessions do not close terminal; CI still exits correctly with proper exit codes. **E) DOCS/PROOF**: Created `docs/PROOFS/world_lock_request_id_api_pass.md` with evidence items for WorldLock middleware, RequestId API stack integration, and Commerce read-path fix. Created `docs/PROOFS/ops_no_exit_pass.md` with evidence that no ops scripts contain hard exits anymore (grep output example). No refactors, no business logic added, no DB schema changes. Minimal diff, localized changes. PowerShell 5.1 compatible, ASCII-only output, safe exit behavior preserved.
- **PRODUCT WRITE SPINE PACK v1.1 (Commerce 202 write contract, proof-first)**: Implemented real write spine for commerce world only (POST/PATCH/DELETE `/api/v1/commerce/listings`) returning 202 ACCEPTED (SPINE_READY, no persistence, no business rules). **A) ROUTES**: POST/PATCH/DELETE routes for commerce listings already present in `work/pazar/routes/api.php` with middleware `auth.any + resolve.tenant + tenant.user`. **B) CONTROLLER**: Updated `work/pazar/app/Http/Controllers/Api/Commerce/ListingController.php`: `store()` validates required field `title` (min 3, max 255), returns 202 ACCEPTED with `{ "ok": true, "status": "PENDING", "request_id": "...", "operation": { "type": "CREATE_LISTING", "world": "commerce" } }`; `update()` validates body is not empty (422 VALIDATION_ERROR if empty), checks listing exists in tenant scope (404 NOT_FOUND if cross-tenant), returns 202 ACCEPTED with `{ "ok": true, "status": "PENDING", "request_id": "...", "operation": { "type": "UPDATE_LISTING", "world": "commerce" } }`; `destroy()` checks listing exists in tenant scope (404 NOT_FOUND if cross-tenant), returns 202 ACCEPTED with `{ "ok": true, "status": "PENDING", "request_id": "...", "operation": { "type": "DELETE_LISTING", "world": "commerce" } }`. All methods enforce tenant boundary (forTenant($tenantId)) and world boundary (forWorld('commerce')), emit audit log via Laravel Log::info() with request_id, tenant_id, world, operation type, listing_id (if applicable). **C) DOCUMENTATION**: Updated `docs/product/PRODUCT_API_SPINE.md`: Marked commerce write endpoints as SPINE_READY v1.1 (202 ACCEPTED, persistence deferred), documented 202 response schema + 422/401/403/404 behavior, noted Food and Rentals write endpoints remain 501 NOT_IMPLEMENTED. Created `docs/PROOFS/product_write_spine_pass.md` with real curl transcripts for POST 202, PATCH 202, DELETE 202, unauthorized 401/403, validation 422 (missing title), validation 422 (empty body), cross-tenant 404, audit logging verification, persistence verification. **D) CHANGELOG**: Added entry for Product Write Spine Pack v1.1. No schema changes, no migrations, no refactors. Minimal diff, localized changes. Persistence intentionally deferred (no schema changes, no business rules). PowerShell 5.1 compatible, ASCII-only output, safe exit behavior preserved.
- **PRODUCT WRITE SPINE PACK v1 (RC0-safe, no business logic, but real write contract)**: Moved from read-only to real Product API write spine without implementing domain business rules. **A) CANONICAL WRITE ENDPOINTS**: Updated all enabled worlds (commerce, food, rentals) ListingController's: POST `/api/v1/{world}/listings` returns 202 ACCEPTED (SPINE_READY, no persistence), PATCH `/api/v1/{world}/listings/{id}` returns 202 ACCEPTED (SPINE_READY, no persistence), DELETE `/api/v1/{world}/listings/{id}` returns 202 ACCEPTED (SPINE_READY, no persistence). All write endpoints enforce auth + tenant + world boundary (auth.any + resolve.tenant + tenant.user middleware), tenant-scoped queries (404 NOT_FOUND for cross-tenant access), world-scoped enforcement (400 WORLD_CONTEXT_INVALID for invalid world). Required field validation enforced (title required for POST, 422 VALIDATION_ERROR if missing). **B) AUDIT LOGGING**: Added Laravel Log::info() calls for all write operations (request_id, tenant_id, world, operation type: CREATE_LISTING, UPDATE_LISTING, DELETE_LISTING). Logging uses existing Laravel logger (no new tables, no outbox mechanism). **C) RESPONSE CONTRACT**: All write endpoints return deterministic 202 ACCEPTED response: `{ "ok": true, "status": "PENDING", "request_id": "uuid", "operation": { "type": "CREATE_LISTING|UPDATE_LISTING|DELETE_LISTING", "world": "<world>" } }`. Error responses follow standard envelope (422 VALIDATION_ERROR, 401 UNAUTHORIZED, 403 FORBIDDEN, 404 NOT_FOUND, 500 TENANT_CONTEXT_MISSING, 400 WORLD_CONTEXT_INVALID). **D) DOCUMENTATION + PROOF**: Updated `docs/product/PRODUCT_API_SPINE.md`: Marked write endpoints as SPINE_READY (202 ACCEPTED, no business rules), documented 202 schema + 422/401/403/404 behavior, noted persistence is intentionally deferred (no schema changes). Created `docs/PROOFS/product_write_spine_pass.md` with acceptance tests (POST/PATCH/DELETE examples, unauthorized example, validation example, audit logging verification, persistence verification). No schema changes, no refactors, no business logic. Minimal diff, localized changes. Persistence intentionally deferred (no schema changes, no business rules). PowerShell 5.1 compatible, ASCII-only output, safe exit behavior preserved.
- **PRODUCT READ SURFACE EXPANSION + OBS RECONCILE PACK v1 (RC0 -> Product Dev Bridge)**: Expanded tenant-scoped READ path to all enabled worlds and ensured observability status script is present. **A) OBSERVABILITY RECONCILE**: Created `ops/observability_status.ps1`: Observability status check script validating Pazar /metrics (token-aware if METRICS_TOKEN set; supports header X-Metrics-Token and query token), H-OS /v1/health, Prometheus ready + targets (optional: WARN if unreachable), Alertmanager ready (optional: WARN if unreachable), Prometheus rules group "pazar_baseline" present (optional: WARN if Prometheus unreachable). Uses `ops/_lib/ops_output.ps1` and `ops/_lib/ops_exit.ps1` for safe-exit behavior. ASCII-only markers ([PASS]/[WARN]/[FAIL]) via Write-Pass/Write-Warn/Write-Fail. Exit via Invoke-OpsExit (no terminal closure in interactive). Integrated into `ops/ops_status.ps1` as NON-BLOCKING check (Optional = $true). **B) PRODUCT READ SURFACE EXPANSION**: Verified all enabled worlds (commerce, food, rentals) have tenant-scoped READ endpoints implemented correctly: GET `/api/v1/{world}/listings` and GET `/api/v1/{world}/listings/{id}` with middleware chain (auth.any + resolve.tenant + tenant.user), tenant-scoped queries (no cross-tenant leakage), world-scoped enforcement (forWorld('<world>') guard), error contract preserved (401/403/404 with standard envelope + request_id). Write endpoints (POST/PATCH/DELETE) remain stubbed (501 NOT_IMPLEMENTED). All enabled worlds already implemented (no new code needed, verification only). **C) DOCS + PROOFS**: Updated `docs/product/PRODUCT_API_SPINE.md`: Confirmed all enabled worlds (commerce, food, rentals) GET endpoints are IMPLEMENTED (Read-Path v2, tenant-scoped). Created `docs/PROOFS/product_read_surface_all_worlds_pass.md` with acceptance tests (unauthorized checks for all worlds, authenticated list/show for all worlds, write endpoints remain 501, middleware verification, world governance verification). No schema changes, no refactors, no new write logic. Minimal diff, verification-only changes. PowerShell 5.1 compatible, ASCII-only output, safe exit behavior preserved.
- **RC0 CLOSEOUT v1 (Release Bundle + RC0 Tag Discipline + Handover-Grade Checklist)**: Made RC0 releasable by adding deterministic release bundle generator and human-readable RC0 release checklist. **A) RELEASE BUNDLE GENERATOR**: Updated `ops/release_bundle.ps1` to create timestamped folder (`_archive/releases/rc0-YYYYMMDD-HHMMSS/`) with minimum sufficient evidence files: meta.txt (git branch, commit, remote, git status --porcelain, timestamp, Docker/Compose versions), ops_status.txt (output of ops/run_ops_status.ps1 or ops/ops_status.ps1), incident_bundle_link.txt (if ops_status FAIL and incident bundle produced, record path), routes_snapshot.txt (ops/snapshots/routes.pazar.json if exists), schema_snapshot.txt (ops/snapshots/schema.pazar.sql if exists), changelog_unreleased.txt (extract [Unreleased] section from CHANGELOG.md), version.txt (VERSION file if exists), architecture.txt (docs/ARCHITECTURE.md if exists), repo_layout.txt (docs/REPO_LAYOUT.md if exists), rules.txt (docs/RULES.md if exists), proofs_index.txt (list docs/PROOFS/*.md with last write time). Missing optional files result in WARN (exit code 2), not FAIL. Prints `RELEASE_BUNDLE_PATH=<path>` as output. Exit codes: 0 PASS (bundle created), 2 WARN (bundle created but some optional files missing), 1 FAIL (cannot create folder). Ensured `_archive/releases/` is untracked in `.gitignore` (already present). **B) RC0 RELEASE CHECKLIST**: Updated `docs/runbooks/rc0_release.md` with preconditions (repo clean, core stack up, ops status PASS/WARN no FAIL), release steps (1) Run ops/doctor.ps1, 2) Run ops/run_ops_status.ps1, 3) Generate release bundle: ops/release_bundle.ps1, 4) Tagging discipline: tag name format rc0-YYYYMMDD, tag must point to commit with PASS/WARN gates only, if FAIL → fix first then tag, tag creation is manual), evidence expectations (release bundle folder contains ops_status + snapshots + rules + proofs list), rollback note (how to revert to previous tag: git checkout/tag only; no data wipe). **C) GOVERNANCE WIRING**: Updated `docs/RULES.md`: added Rule 58 - RC0 release requires release bundle and rc0_release runbook updates when entrypoints or gates change. Created `docs/PROOFS/rc0_release_bundle_pass.md` with acceptance tests (full bundle generation PASS, missing optional files WARN, incident bundle link, exit codes, RELEASE_BUNDLE_PATH output, git ignore verification, proofs index example). No schema changes, no refactors, no domain logic additions. Minimal diff, localized changes. PowerShell 5.1 compatible, ASCII-only output, safe exit behavior preserved. UTF-8 without BOM for new scripts.
- **RC0 STABILITY + PRODUCT API SPINE CONSISTENCY PACK v1 (Single PR)**: Eliminated remaining RC0 blockers (Laravel Monolog permission denied, API 404/500 drift) and made Product API spine consistent across all enabled worlds. **A) STORAGE SELF-HEAL**: Created `work/pazar/docker/ensure_storage.sh`: Storage self-heal script ensuring storage/logs and bootstrap/cache are writable by www-data on every container start, creates laravel.log with chmod 0666 (bulletproof append-safe), runs idempotently before supervisord. Updated `docker-compose.yml`: pazar-app service command runs ensure_storage.sh before supervisord (`sh -lc "./docker/ensure_storage.sh && exec supervisord -c /etc/supervisord.conf"`), preserves named volumes (pazar_storage, pazar_cache), no image rebuild required. Created `docs/PROOFS/storage_self_heal_pass.md`: Evidence checklist (container start with storage self-heal, UI route not 500, laravel.log writable check, storage directories writable, smoke surface gate PASS). Updated `docs/runbooks/storage_permissions.md`: Added Storage Self-Heal Script section explaining ensure_storage.sh, why it's needed, execution flow. **B) PRODUCT API SPINE CONSISTENCY**: Upgraded `work/pazar/app/Support/ApiSpine/ListingReadModel.php`: Added `forTenant(string $tenantId): self` and `forWorld(string $world): self` fluent builder methods, baseQuery() applies tenant_id and world filters, maintains existing pagination shape (cursor-based, deterministic, world/tenant safe). Updated `work/pazar/routes/api.php`: Added world defaults to all enabled world route groups (`->defaults('world', 'commerce')` for commerce, `->defaults('world', 'food')` for food, `->defaults('world', 'rentals')` for rentals), ensures WorldResolver can set ctx.world correctly, all routes already have auth.any + resolve.tenant + tenant.user middleware. Controllers already use Listing model with forTenant/forWorld scopes (no changes needed, already consistent). **C) OPS SELF-AUDIT**: Updated `ops/product_spine_check.ps1`: Added Check 6 (All Enabled Worlds READ Routes) - reads enabled worlds from config/worlds.php, validates all enabled worlds (commerce, food, rentals) have GET /api/v1/{world}/listings and GET /api/v1/{world}/listings/{id} routes, reports PASS/WARN/FAIL in table format, fails loudly on 404 for defined endpoints. Updated `docs/product/PRODUCT_API_SPINE.md`: Marked all enabled worlds (commerce, food, rentals) GET endpoints as IMPLEMENTED (tenant-scoped), documented required headers (X-Tenant-Id, Authorization), documented world defaults on routes, explicitly stated write endpoints remain NOT_IMPLEMENTED (stub). Created `docs/PROOFS/product_api_spine_consistency_pass.md`: Evidence checklist (unauthorized GET returns 401/403 with envelope, authenticated GET returns 200 ok:true, cross-tenant access returns 404, POST returns 501 NOT_IMPLEMENTED, no 404s for defined endpoints, product spine check validates all enabled worlds, world defaults set on routes). No schema changes, no refactors, no domain logic additions. Minimal diff, localized changes. PowerShell 5.1 compatible, ASCII-only output, safe exit behavior preserved.
- **SMOKE SURFACE GATE PACK v1 (RC0 Release Lock)**: Made RC0 truly "release-safe" by locking critical surfaces with automated smoke gate. Created `ops/smoke_surface.ps1`: Smoke surface gate script validating Pazar /up → 200, Pazar /metrics → 200 AND Content-Type starts with "text/plain" AND body contains pazar_ metric AND no BOM artifact, API error contract smoke (GET /api/non-existent-endpoint → 404 JSON envelope includes request_id non-null), Admin UI surface must not 500 (GET /ui/admin/control-center no auth should be 200/302/401/403, BUT MUST NOT be 500). If response is 500 or contains Monolog "Permission denied" in body, gate FAILs with actionable remediation hints (storage/logs and bootstrap/cache writable by php-fpm user www-data, ensure runtime permission fix executes on every container start, confirm storage volume is named volume not bind mount). Optional (WARN-only): If Prometheus reachable (9090), verify /api/v1/targets has pazar job up; else WARN. Uses `ops/_lib/ops_output.ps1` and `ops/_lib/ops_exit.ps1` for safe-exit behavior. Integrated into `ops/ops_status.ps1` as BLOCKING check. Created `.github/workflows/smoke-surface.yml`: CI gate running on push/PR to main/develop when Pazar code, smoke_surface.ps1, docker-compose.yml, or workflow file changes, brings up core stack, runs smoke_surface.ps1, uploads logs on failure, always cleans up. Created `docs/runbooks/smoke_surface.md`: What it checks, how to interpret results, common failures (Monolog permission errors, storage permissions, error contract violations), troubleshooting, incident response. Created `docs/PROOFS/smoke_surface_pass.md` with acceptance tests (full PASS, WARN when Prometheus not reachable, FAIL when Monolog permission error, FAIL when error contract violated, ops_status integration, CI gate, Admin UI redirect acceptable). Updated `docs/RULES.md`: added Rule 57 - RC0 requires smoke-surface gate PASS/WARN (FAIL blocks release). This ensures Monolog storage/logs permission errors and other critical failures are caught before release, not just as "one-time" issues. No schema changes, no refactors, no domain logic additions. PowerShell 5.1 compatible, ASCII-only output, safe exit behavior preserved.
- **PRODUCT CONTRACTS + OPENAPI PACK v1 (Spine becomes self-auditing, RC0-safe)**: Made Product API Spine self-auditing to prevent silent drift. Created `docs/product/openapi.yaml`: OpenAPI 3.1.0 specification documenting all implemented endpoints (GET /api/v1/{world}/listings, GET /api/v1/{world}/listings/{id} for commerce/food/rentals, write-stub endpoints POST/PATCH/DELETE returning 501 NOT_IMPLEMENTED), shared components (ErrorEnvelope with ok:false, error_code, message, request_id, details?), CursorPagination, common headers (X-Request-Id), security schemes (bearerAuth, sessionAuth), response schemas (200 SuccessResponse, 401/403/404/422/501 ErrorEnvelope). Created `ops/openapi_contract.ps1`: Contract check script validating file exists, YAML structure (openapi, paths, components, ErrorEnvelope schema, request_id field), documentation drift guard (PRODUCT_API_SPINE.md references openapi.yaml), optional endpoint probe (if Docker stack reachable, validates unauthorized endpoint returns 401/403 with request_id in body). Uses `ops/_lib/ops_output.ps1` and `ops/_lib/ops_exit.ps1` for safe-exit behavior. Integrated into `ops/ops_status.ps1` as BLOCKING check. Created `.github/workflows/openapi-contract.yml`: CI gate running on push/PR when OpenAPI spec or related files change, no Docker required for baseline checks, endpoint probe auto-skips if not available (WARN only, never blocks CI unless contract file/structure is wrong). Created `docs/runbooks/openapi_contract.md`: How to update openapi.yaml safely, what breaks the gate, how to verify locally, troubleshooting. Created `docs/PROOFS/openapi_contract_pass.md` with acceptance tests (full PASS, WARN when stack not reachable, FAIL when file missing, ops_status integration, CI gate). Updated `docs/product/PRODUCT_API_SPINE.md`: added reference to openapi.yaml as single source of truth. No schema changes, no refactors, no new runtime dependencies. Single source: openapi.yaml; other docs point to it. PowerShell 5.1 compatible, ASCII-only output, safe exit behavior preserved.
- **PRODUCT SPINE E2E SMOKE + WRITE-STUB GOVERNANCE v1 (RC0-safe)**: Made Product API spine end-to-end verifiable in one deterministic run. Write-stub governance already in place (all enabled worlds have write endpoints POST/PATCH/DELETE that return 501 NOT_IMPLEMENTED via `NotImplemented::response()` helper). Created `ops/product_spine_smoke.ps1`: E2E smoke test script validating read-path surface exists (GET endpoints return 401/403 when unauthorized), write governance exists (write endpoints are protected and return 501 NOT_IMPLEMENTED when authorized), contract compliance (all responses include standard JSON envelope with `ok`, `error_code`, `message`, `request_id`). Checks all enabled worlds (commerce, food, rentals). Gracefully handles missing credentials (WARN if missing, not FAIL). Uses `ops/_lib/ops_output.ps1` and `ops/_lib/ops_exit.ps1` for safe-exit behavior. Integrated into `ops/ops_status.ps1` as BLOCKING check (after Product Read-Path). Updated `docs/runbooks/product_spine.md`: added Product Spine E2E Smoke Test section with purpose, running instructions, required env vars, expected outputs, troubleshooting. Created `docs/PROOFS/product_spine_smoke_pass.md` with acceptance tests (unauthorized checks PASS, full E2E PASS, write-stub 501 response, ops_status integration). No schema changes, no refactors, minimal diff. Existing write-stub governance preserved (no breaking changes). PowerShell 5.1 compatible, ASCII-only output, safe exit behavior preserved.
- **PRODUCT READ-PATH EXPANSION PACK v2 (Food + Rentals) — RC0-safe, self-audited**: Extended Commerce read-path pattern to Food and Rentals worlds. Food and Rentals ListingController'ları zaten mevcut ve read-path implementasyonu yapılmış (index ve show methodları tenant-scoped, world-scoped). Updated `ops/product_read_path_check.ps1`: added unauthorized checks for Food and Rentals (GET /api/v1/food/listings, GET /api/v1/rentals/listings return 401/403 with JSON envelope), added authenticated checks for Food and Rentals (GET /api/v1/food/listings and /api/v1/food/listings/{id}, GET /api/v1/rentals/listings and /api/v1/rentals/listings/{id} return 200 OK with ok:true or 404 NOT_FOUND with ok:false), all checks follow same pattern as Commerce (unauthorized surface check always runs, authenticated checks WARN if credentials missing). Updated `docs/product/PRODUCT_API_SPINE.md`: marked Food and Rentals GET endpoints as IMPLEMENTED (Read-Path v2), explicitly stated write endpoints remain NOT_IMPLEMENTED (501). Created `docs/PROOFS/product_read_path_v2_pass.md` with acceptance tests (unauthorized checks for all worlds, authenticated checks for all worlds, write endpoints remain 501, ops_status integration). No schema changes, no refactors, minimal diff. Existing Commerce endpoints preserved (no breaking changes). Write endpoints (POST/PATCH/DELETE) remain 501 NOT_IMPLEMENTED for Food and Rentals (no accidental domain drift). No disabled-world code introduced (world governance gates remain satisfied). PowerShell 5.1 compatible, ASCII-only output, safe exit behavior preserved.
- **PRODUCT MVP LOOP v1 (Read+Write+Ops E2E, zero drift)**: Completed Product MVP Loop with full lifecycle support. Added disable endpoint: PATCH `/api/v1/products/{id}/disable` in `routes/api.php` with middleware `auth.any` + `resolve.tenant` + `tenant.user`. Updated `app/Http/Controllers/Api/ProductController.php`: added `disable()` method with tenant/world boundary enforcement, soft delete (sets status to 'archived'), idempotent behavior (returns 200 OK if already archived), standard error envelope (404 NOT_FOUND, 422 VALIDATION_ERROR, 422 WORLD_CONTEXT_INVALID, 500 INTERNAL_ERROR), 200 OK response with `ok:true`, `data.item.status: "archived"`, `request_id`. Created `app/Http/Controllers/MetricsController.php`: Prometheus-compatible metrics endpoint (GET /api/metrics) with counters `pazar_product_create_total`, `pazar_product_disable_total`, gauge `pazar_products_total` (from DB count). Updated `ProductController`: calls `MetricsController::incrementProductCreate()` on create, `MetricsController::incrementProductDisable()` on disable. Created `ops/product_mvp_check.ps1`: E2E test script validating complete lifecycle (create → list → show → disable → list confirms disabled state + cross-tenant isolation), credential validation (WARN if missing in local, FAIL in CI), login/token acquisition, all steps with envelope verification (ok:true, request_id). Integrated into `ops/ops_status.ps1` as BLOCKING check (after Tenant Boundary). Updated `docs/product/PRODUCT_API_SPINE.md`: added Disable Product endpoint documentation, lifecycle states (draft, published, archived), idempotent behavior, error codes. Created `docs/PROOFS/product_mvp_loop_pass.md` with acceptance tests (MVP loop E2E PASS, create/disable, cross-tenant isolation, metrics endpoint, ops_status). No schema changes (status field already exists), no refactors, minimal diff. Existing endpoints preserved (no breaking changes). PowerShell 5.1 compatible, ASCII-only output, safe exit behavior preserved.
- **PRODUCT WRITE SPINE v1 (Create path + DB contract + ops gate update, RC0-safe)**: Completed Product Write Spine with ops gate integration. Updated `ops/product_spine_check.ps1`: added Check 6 (Product Write Runtime Test) - validates create/list/show flow end-to-end when credentials available (PRODUCT_TEST_EMAIL, PRODUCT_TEST_PASSWORD, TENANT_A_SLUG, WORLD), creates product via POST /api/v1/products, lists products via GET /api/v1/products, shows product via GET /api/v1/products/{id}, verifies envelope (ok:true, request_id), returns WARN/SKIP if credentials missing (non-blocking in local, FAIL in CI). Runtime test is optional (credentials required), static checks (routes, middleware, write-path lock) remain primary validation. Updated `docs/product/PRODUCT_API_SPINE.md`: confirmed POST /api/v1/products is IMPLEMENTED (Write-Seed v1), documented request/response schema, validation rules, error codes, tenant/world boundary behavior. Created `docs/PROOFS/product_write_spine_pass.md` with acceptance tests (product_spine_check with runtime test PASS, without credentials WARN, create/list/show, cross-tenant isolation). No schema changes (products table already exists), no refactors, minimal diff. Existing read endpoints preserved (no breaking changes). Ops status integration complete (product_spine_check includes runtime test). PowerShell 5.1 compatible, ASCII-only output, safe exit behavior preserved.
- **PRODUCT SPINE GOVERNANCE PACK v1 (E2E self-audit + CI gate, zero drift)**: Created Product Spine E2E self-audit gate for end-to-end validation (create → list → show + tenant boundary). Created `ops/product_spine_e2e_check.ps1`: E2E test script with health check, credential validation (WARN if missing in local, FAIL in CI), login/token acquisition, create product (POST /api/v1/products), list products (GET /api/v1/products), show product (GET /api/v1/products/{id}), cross-tenant isolation (404/403 for cross-tenant access), error contract validation (422 error envelope with ok:false, error_code, message, request_id). Uses `ops/_lib/ops_output.ps1` and `ops/_lib/ops_exit.ps1` for safe-exit behavior. Integrated into `ops/ops_status.ps1` as BLOCKING check (after Product Spine Check). Created `.github/workflows/product-spine.yml`: CI workflow for push/PR to main/develop, runs product_spine_e2e_check.ps1 with secrets (PRODUCT_TEST_EMAIL, PRODUCT_TEST_PASSWORD, TENANT_A_SLUG, TENANT_B_SLUG, WORLD), uploads logs on failure. Updated `docs/runbooks/product_spine.md`: added E2E test documentation, credential requirements, troubleshooting steps. Updated `docs/RULES.md`: added Rule 56 "Product spine E2E gate must PASS before product write expansion". Created `docs/PROOFS/product_spine_e2e_gate_pass.md` with acceptance tests (local without credentials WARN/SKIP, local with credentials PASS, CI without credentials FAIL, cross-tenant isolation, error contract). No app refactor, only additive ops/docs + CI workflow. PowerShell 5.1 compatible, ASCII-only output, safe-exit behavior preserved.
- **PRODUCT WRITE SEED PACK v1 (Create-only, tenant+world enforced, RC0-safe)**: Added create-only write endpoint (POST /api/v1/products) to Product Core Spine. Updated `app/Http/Controllers/Api/ProductController.php`: added `store()` method with tenant context resolution, world boundary enforcement (required X-World header or body.world, 422 VALIDATION_ERROR if missing, 422 WORLD_CONTEXT_INVALID if not enabled), input validation (title min 3, type required, status default draft, price_amount >=0), explicit tenant_id assignment from resolved context (guarded, not user-controlled), standard error envelope (422 VALIDATION_ERROR with field details, 422 WORLD_CONTEXT_INVALID, 500 INTERNAL_ERROR), 201 CREATED response with `ok:true`, `data.id`, `data.item`. Updated `app/Models/Product.php`: moved `tenant_id` from fillable to guarded (prevents mass assignment, cross-tenant leakage protection). Added route in `routes/api.php`: POST `/api/v1/products` with middleware `auth.any` + `resolve.tenant` + `tenant.user`. Updated `docs/product/PRODUCT_API_SPINE.md`: marked POST /api/v1/products as IMPLEMENTED (Write-Seed v1), documented request headers/body schema, response schema, error codes, tenant/world boundary behavior. Created `docs/PROOFS/product_write_seed_pass.md` with acceptance tests (401/403, 422 missing world, 422 invalid world, 422 validation error, 201 successful create, tenant boundary enforcement). Ops gates (product_spine_check, security_audit) automatically validate new route. No schema changes, no refactors, minimal diff. Update/Delete endpoints remain 501 NOT_IMPLEMENTED. PowerShell 5.1 compatible, ASCII-only output, safe exit behavior preserved.
- **PRODUCT CORE SPINE PACK v1 (Canonical Product model + DB contract + Read-only endpoint, RC0-safe)**: Created canonical Product Core Spine for all worlds (commerce, food, rentals, future). Created migration `2026_01_11_000000_create_products_table.php`: products table with columns (id, tenant_id, world, type, title, status, currency, price_amount, payload_json, created_at, updated_at), indexes (tenant_id, world, type, status, composite (tenant_id, world, status)). Created `app/Models/Product.php`: Eloquent model with scopes `forTenant($tenantId)`, `forWorld($world)`, `forStatus($status)`, guarded/fillable minimal. Created `app/Http/Controllers/Api/ProductController.php`: read-only endpoints `index()` and `show()`, tenant context resolution, world boundary enforcement (required query param `?world=commerce` or `X-World` header, 422 VALIDATION_ERROR if missing), cursor pagination (limit clamp 1-100, default 20, after_id), standard error envelope (404 NOT_FOUND, 422 VALIDATION_ERROR, 400 WORLD_NOT_ENABLED, 500 TENANT_CONTEXT_MISSING). Added routes in `routes/api.php`: GET `/api/v1/products` and GET `/api/v1/products/{id}` with middleware `auth.any` + `resolve.tenant` + `tenant.user`. Updated `docs/product/PRODUCT_API_SPINE.md`: marked `/api/v1/products` endpoints as IMPLEMENTED (Read-Only v1), defined request headers/params (tenant + world), defined response schema, explicitly stated write endpoints not implemented yet (501). Updated `ops/product_spine_check.ps1`: added Check 1b (Products READ routes exist), Check 2b (Products middleware contract), extended Check 3 (Write-path lock includes /api/v1/products*). Created `docs/PROOFS/product_core_spine_pass.md` with acceptance tests (migration, 401/403, 422 missing world, 200 OK, 404 NOT_FOUND, ops_status, schema snapshot). No schema changes to existing tables, no refactors, minimal diff. Existing commerce listings endpoints preserved (no breaking changes). PowerShell 5.1 compatible, ASCII-only output, safe exit behavior preserved.
- **PRODUCT SPINE GOVERNANCE PACK v1 (Self-Governing Product API, RC0-safe, Minimal Diff)**: Created snapshot-driven Product Spine Check gate to automatically validate Commerce Product API changes. Created `ops/product_spine_check.ps1`: validates Commerce read routes exist (GET /api/v1/commerce/listings and /{id}), middleware contract (auth.any + resolve.tenant + tenant.user with alias support), write-path lock (POST/PUT/PATCH/DELETE must be allowlisted or return 501 NOT_IMPLEMENTED), world boundary evidence (WARN-only, snapshot-based with minimal file I/O fallback), tenant boundary evidence (WARN-only, minimal file I/O). Supports parameters: `-RoutesSnapshotPath` (default: ops/snapshots/routes.pazar.json), `-AllowlistPath` (default: ops/policy/product_spine_allowlist.json). Uses helper functions: Normalize-Uri, Normalize-Method, Read-JsonSafely, Find-Route, Parse-Middleware, Normalize-MiddlewareName (handles resolve.tenant vs tenant.resolve, tenant.user vs ensure.tenant.user). Created `ops/policy/product_spine_allowlist.json` (empty allowlist, format: `{"allow_write_endpoints": [{"method":"POST","uri":"/api/v1/commerce/listings","reason":"...","ticket":"..."}]}`). Integrated into `ops/ops_status.ps1` as BLOCKING check (after Conformance, before Snapshots). Created `docs/runbooks/product_spine_governance.md` with gate enforcement, failure remediation, allowlist usage, RC0 and drift prevention. Updated `docs/RULES.md` with Rule 55: "Any change under work/pazar/routes/api.php or Api/Commerce controllers requires product_spine_check PASS/WARN; write endpoints require allowlist + proof". Updated `docs/PROOFS/product_spine_governance_pass.md` with commands and expected outputs. Updated `CHANGELOG.md` with Unreleased entry. No schema changes, no refactors, minimal diff. PowerShell 5.1 compatible, ASCII-only output, safe exit behavior preserved. Snapshot-driven (no Docker required), fails loudly on missing auth/tenant middleware or accidental write routes. Updated `ops/product_spine_check.ps1`: added Commerce-specific checks - A1: Commerce Read Surface exists (GET /api/v1/commerce/listings and GET /api/v1/commerce/listings/{id}), A2: Read routes must be protected (auth.any + resolve.tenant + tenant.user middleware), A3: World boundary evidence (forWorld('commerce') in controller code), A4: Write-path lock (POST/PATCH/DELETE return 501 NOT_IMPLEMENTED or are allowlisted), A5: Cross-tenant leakage guard (forTenant/tenant_id filter in read paths), A6: Disabled world policy (no routes for disabled worlds). Added allowlist support: reads `ops/policy/product_spine_allowlist.json` to allow write endpoints that are not stubs (format: `{"allow_write_endpoints": [{"method":"POST","path":"/api/v1/commerce/listings","reason":"...","ticket":"..."}]}`). Created `ops/policy/product_spine_allowlist.json` (empty allowlist, write endpoints must return 501 NOT_IMPLEMENTED). Updated `ops/ops_status.ps1`: Product Spine Check step runs after Conformance and before Snapshots. Updated `docs/runbooks/product_spine_governance.md`: added allowlist documentation, how to allowlist write endpoints safely. Updated `docs/PROOFS/product_spine_governance_pass.md`: added Commerce-specific check examples (A1-A6), allowlist verification. Updated `docs/RULES.md` with Rule 55: "Any change to /api/v1/* product endpoints requires product_spine_check PASS/WARN; write endpoints require allowlist + proof". No schema changes, no refactors, minimal diff. PowerShell 5.1 compatible, ASCII-only output, safe exit behavior preserved.
- **PRODUCT SPINE GOVERNANCE + WRITE-STUB LOCK v1 (RC0-safe)**: Added Product Spine Governance gate to validate API spine surface + middleware posture for enabled/disabled worlds. Updated `work/pazar/app/Http/Controllers/Api/Commerce/ListingController.php`: converted write-path methods (store, update, destroy) to 501 NOT_IMPLEMENTED stubs using `NotImplemented::response()` helper (removed DB write logic, no business logic, consistent with Food/Rentals stub behavior). Response format: HTTP 501, JSON `{ ok:false, error_code:"NOT_IMPLEMENTED", message:"Commerce listings API write operations are not implemented yet.", request_id:"..." }`, `X-Request-Id` header matching body `request_id`. Created `ops/product_spine_governance.ps1`: validates enabled worlds have required routes (GET/POST/PATCH/DELETE `/api/v1/{world}/listings` and GET `/api/v1/{world}/listings/{id}`) with correct middleware (`auth.any`, `resolve.tenant`, `tenant.user`), validates disabled worlds have NO routes (disabled-world policy), uses routes snapshot for static validation (no Docker required), falls back to filesystem check if snapshot missing (WARN). Output table format: World | Surface | Middleware | Status | Notes. Exit codes: 0 PASS, 2 WARN, 1 FAIL (Invoke-OpsExit). Integrated product_spine_governance into `ops/ops_status.ps1` as BLOCKING check (after tenant_boundary, before product_write_spine). Created `docs/runbooks/product_spine_governance.md` with gate purpose, how to run, troubleshooting, incident response. Created `docs/PROOFS/product_spine_governance_pass.md` with acceptance tests (PASS/WARN/FAIL scenarios, Commerce write-path stub verification). Updated `docs/RULES.md` with Rule 54: "Product spine governance gate PASS required (RC0 and beyond)". No schema changes, no refactors, minimal diff, no changes to disabled worlds. PowerShell 5.1 compatible, ASCII-only output, safe exit behavior preserved.
- **PRODUCT MULTI-WORLD READ-PATH + SPINE GATE PACK v2 (RC0-safe)**: Implemented Food and Rentals read-path endpoints with same security posture as Commerce (tenant-scoped, world-enforced). Updated `work/pazar/app/Http/Controllers/Api/Food/ListingController.php` and `work/pazar/app/Http/Controllers/Api/Rentals/ListingController.php`: implemented `index()` and `show()` methods with tenant/world enforcement (same pattern as Commerce), tenant context resolution, world context validation (400 WORLD_CONTEXT_INVALID if mismatch), cross-tenant isolation (404 NOT_FOUND), cursor-based pagination (limit clamp 1-100, default 20), stable response envelope (`data.items`, `cursor.next`, `meta.count/limit` for index, `data.item` for show). Updated `work/pazar/routes/api.php`: moved Food and Rentals GET endpoints under `auth.any + resolve.tenant + tenant.user` middleware (eliminated public read leakage), ensured same middleware chain as Commerce. Updated `ops/product_spine_check.ps1`: reads enabled worlds from `work/pazar/config/worlds.php`, validates routes and middleware for ALL enabled worlds (not just one), uses routes snapshot for static validation (no Docker required), attempts to generate snapshot if missing, falls back to filesystem check (WARN). Updated `docs/product/PRODUCT_API_SPINE.md`: marked Food and Rentals GET endpoints as IMPLEMENTED (v2), aligned response shape and error codes with Commerce format, updated authentication section to reflect Food/Rentals implementation. Created `docs/PROOFS/product_multiworld_read_path_pass.md` with acceptance tests (401/403/200/404 for all enabled worlds, cross-tenant isolation, world mismatch). Created `.github/workflows/product-spine.yml` for CI gate (runs on PR/push, no Docker required, uploads artifacts on fail). Created `docs/runbooks/product_spine.md` with gate purpose, how to run, troubleshooting, incident response. Updated `docs/RULES.md` with Rule 53: "Enabled worlds product read-path routes MUST be tenant-scoped (auth.any + resolve.tenant + tenant.user)". No schema changes, no refactors, minimal diff, no changes to disabled worlds. PowerShell 5.1 compatible, ASCII-only output, safe exit behavior preserved.
- **PRODUCT WRITE-SPINE v1 (Commerce Create Stub → Real Create, Zero Drift, Gates First)**: Implemented Commerce POST `/api/v1/commerce/listings` create endpoint with tenant/world boundaries, read-after-write validation, and cross-tenant isolation. Updated `docs/product/PRODUCT_API_SPINE.md` to mark POST endpoint as IMPLEMENTING v1 with request schema using existing table columns only (title, description, price_amount, currency, status), response envelope `{ ok:true, data:{ id, item }, request_id }` (201 CREATED), error responses (422 VALIDATION_ERROR, 401/403, 500 TENANT_CONTEXT_MISSING), and explicit tenant/world boundary behavior (tenant_id from resolved context NOT request body, world='commerce' enforced NOT from request body). Verified `work/pazar/app/Http/Controllers/Api/Commerce/ListingController.php` store() method: enforces `forWorld('commerce')` and `forTenant($tenantId)`, validates input using Laravel validator (title required min 3 max 120, description nullable max 5000, price_amount nullable integer min 0, currency nullable size 3 in TRY|USD|EUR, status nullable in draft|published), creates record scoped to tenant (tenant_id from resolved context, NOT request body), returns 201 with stable envelope. Verified `work/pazar/routes/api.php` POST route is under `auth.any + resolve.tenant + tenant.user` middleware (not publicly writable). Created `ops/product_write_spine_check.ps1`: validates unauthorized POST (401/403 envelope + request_id), authorized but missing tenant (403 + request_id), authorized + tenant create (201 ok:true with data.id and data.item), read-after-write (GET /listings/{id} with same tenant -> 200 ok:true), cross-tenant read test (GET same id with tenant B -> 404 NOT_FOUND, no leakage). Uses same credentials/env approach as tenant_boundary/product_spine_check (TENANT_TEST_ID, PRODUCT_TEST_TOKEN, TENANT_B_TEST_ID for cross-tenant test). ASCII-only output, uses `Invoke-OpsExit` and `ops_output.ps1` helpers. Exit codes: 0 PASS, 2 WARN (skipped due to missing creds), 1 FAIL. Integrated product_write_spine_check into `ops/ops_status.ps1` as BLOCKING check (after tenant_boundary, before session_posture). Created `docs/PROOFS/product_write_spine_v1_pass.md` with acceptance tests (401/403/201/200/404 contract tests, create listing, validation error, read-after-write, cross-tenant isolation). Updated `docs/RULES.md` with Rule 52: "Write-path requires both product_spine_check and product_write_spine_check PASS". No schema changes, no refactors, minimal diff, no changes to food/rentals worlds. PowerShell 5.1 compatible, ASCII-only output, safe exit behavior preserved.
- **PRODUCT SPINE v1.1 (Commerce Read-Path Finalize + Contracts + Self-Audit Gate)**: Finalized Commerce read-path to production-grade STABLE status with consistent envelope, deterministic pagination, and self-auditing ops gate. Updated `docs/product/PRODUCT_API_SPINE.md` to mark Commerce GET endpoints as STABLE and define exact response envelopes: 200 OK `{ ok:true, data:{ items:[...], cursor:{next}, meta:{count,limit} }, request_id }`, 404 NOT_FOUND `{ ok:false, error_code:"NOT_FOUND", message:"...", request_id }`, 401/403 standard error envelope. Defined supported query params: `limit` (default 20, max 100), `cursor` (opaque base64-encoded string), `q` (reserved for future), `status` (reserved for future). Explicitly stated tenant boundary behavior (no cross-tenant leakage, 404 for cross-tenant access) and world boundary (commerce only). Hardened `work/pazar/app/Http/Controllers/Api/Commerce/ListingController.php`: ensured `forWorld('commerce')` and `forTenant($tenantId)` enforced for both `index()` and `show()`, implemented deterministic pagination (limit clamp 1..100, default 20, cursor-based with `id > cursor` logic), returned stable envelope shape (`data.items`, `cursor.next`, `meta.count/limit`), ensured `show()` returns 404 NOT_FOUND if record not found within tenant scope (no leakage). Verified `work/pazar/routes/api.php` Commerce read routes are under `auth.any + resolve.tenant + tenant.user` middleware. Updated `ops/product_spine_check.ps1` to support `TENANT_TEST_ID` environment variable (fallback to `PRODUCT_TEST_TENANT_ID`), enhanced 200 proof check to verify `data.items` array exists in response envelope. Integrated product_spine_check into `ops/ops_status.ps1` as BLOCKING check (already present, verified). Created `docs/PROOFS/product_spine_v11_pass.md` with acceptance tests (401/403/200/404 contract tests, response envelope shape, pagination limit clamp, tenant/world boundary enforcement). Updated `docs/RULES.md` with Rule 51: "Product spine checks must PASS before enabling any write-path for Product". No schema changes, no refactors, minimal diff, no changes to food/rentals worlds. PowerShell 5.1 compatible, ASCII-only output, safe exit behavior preserved.
- **LOGGING & STORAGE SELF-HEAL + GATE PACK v1 (RC0 blocker: Monolog Permission denied)**: Eliminated "Failed to open stream: Permission denied" for `/var/www/html/storage/logs/laravel.log` permanently by hardening boot-time permissions and adding a self-auditing ops gate. Hardened `work/pazar/docker/docker-entrypoint.sh`: ensures directories exist, sets ownership (`chown -R www-data:www-data`), sets directory permissions (`chmod -R ug+rwX`), **CRITICAL**: makes `laravel.log` append-safe (`chmod 0666` for bulletproof permissions, worker can write even if ownership gets weird), adds worker perspective write check (`su -s /bin/sh www-data -c "echo test >> laravel.log"`), if `su` missing falls back to permissive chmod 0777 and logs [WARN]. Hardened `docker-compose.yml` pazar-perms-init command: extends to `touch /var/www/html/storage/logs/laravel.log && chmod 0666 /var/www/html/storage/logs/laravel.log`. Created `ops/storage_write_check.ps1`: validates paths exist, `laravel.log` exists, **CRITICAL**: worker append test - www-data user can append to `laravel.log` (validates actual runtime behavior that php-fpm workers will experience, not just root permission checks), if `su` missing returns WARN with manual instructions, exit codes: 0 PASS, 2 WARN, 1 FAIL, ASCII-only output, uses `Invoke-OpsExit` and `ops_output.ps1` helpers. Integrated storage_write_check into `ops/ops_status.ps1` as BLOCKING check (after triage, before storage_posture). Updated `docs/runbooks/storage_posture.md` with storage_write_check information. Created `docs/PROOFS/storage_write_gate_pass.md` with acceptance tests, evidence that UI no longer 500s on admin control center, and worker append validation. Updated `docs/RULES.md` with Rule 50: "Storage write gate must PASS before RC0/product work continues". No refactors, minimal diff, PowerShell 5.1 compatible, ASCII-only output, safe exit behavior preserved.
- **RC0 Seal Pack v1 (Storage/Monolog Permission Hard Fix + Ops-Gated Proof)**: Eliminated the recurring Laravel Monolog "Permission denied /var/www/html/storage/logs/laravel.log" issue permanently by adding a deterministic entrypoint script (`work/pazar/docker/docker-entrypoint.sh`) that runs on every container start BEFORE nginx/php-fpm handles requests. The entrypoint script ensures: `/var/www/html/storage` exists, `/var/www/html/storage/logs` exists, `/var/www/html/bootstrap/cache` exists, ownership and permissions allow the runtime user (`www-data`) to write, and empty `laravel.log` is created if missing. The script performs a writability probe (`touch /var/www/html/storage/logs/laravel.log`) and fails fast if storage is not writable. Updated `ops/storage_posture_check.ps1` to use `Invoke-OpsExit` and `ops_output.ps1` helpers for safe exit behavior (interactive mode doesn't close terminal, CI mode propagates exit codes). Integrated storage_posture_check into `ops/ops_status.ps1` as BLOCKING check (after doctor/verify, before SLO). Created `docs/runbooks/storage_posture.md` explaining what the check validates, how to remediate, why bind mounts fail on Windows, and the entrypoint script approach. Created `docs/PROOFS/storage_posture_pass.md` with acceptance tests, commands, expected outputs (ASCII markers), and evidence that UI no longer returns 500 errors. Updated `docs/RULES.md` with Rule 49: "Storage posture gate PASS required for RC0". No refactors, minimal diff, PowerShell 5.1 compatible, ASCII-only output, safe exit behavior preserved.
- **RC0 Seal Pack v1 (Storage Permissions Hard Fix + Ops Safe Exit Audit + Gate)**: Hardened RC0 stability by fixing Laravel log permission denied issues and ensuring ops scripts use safe exit behavior. Fixed docker-compose.yml pazar-perms-init command (already correct, verified idempotent command with explicit paths and PASS message). Created `ops/storage_permissions_check.ps1` to verify storage permissions: checks storage/logs directories exist and are writable, laravel.log is writable (touch + append test), bootstrap/cache directory is writable. Output: table style (Check | Status | Notes), exit codes (0 PASS, 2 WARN if Docker/container unavailable, 1 FAIL with remediation hints). Integrated storage_permissions_check into `ops/ops_status.ps1` as BLOCKING check (early, before verify/slo). Audited ops scripts for raw "exit" usage: removed redundant `exit` statements after `Invoke-OpsExit` in ops_status.ps1 (now uses Invoke-OpsExit only, no raw exit), verified doctor.ps1, verify.ps1, triage.ps1, conformance.ps1, schema_snapshot.ps1 all use Invoke-OpsExit correctly (no raw exit). Safe exit behavior: interactive mode sets $global:LASTEXITCODE and returns (terminal stays open), CI mode calls exit (proper exit code propagation). Created `docs/runbooks/storage_permissions.md` explaining Windows/Docker permission issues, named volume rationale, pazar-perms-init behavior, validation commands. Created `docs/PROOFS/storage_permissions_pass.md` with acceptance evidence: compose shows pazar-perms-init ran, container test -w storage/logs, laravel.log writable, UI no longer 500s. Updated `docs/RULES.md` with Rule 48 (Storage-permissions gate PASS required before RC0 tag). No app code changes, no domain/product redesign, only reliability + ops governance hardening. PowerShell 5.1 compatible, ASCII-only output, safe exit behavior preserved. All changes are minimal, localized, ops-only, and preserve existing behavior.
- **Central Ops Governance Pack v1 (ops_status single gate + drift-proofing + release discipline)**: Made `ops/ops_status.ps1` the single source of truth gate for RC0 and day-to-day engineering. Refactored ops_status.ps1 with explicit check registry (array of hashtables with Id, Name, ScriptPath, Blocking, OnFailAction, Arguments metadata). All checks enumerated: ops_drift_guard (BLOCKING), doctor (BLOCKING), verify (BLOCKING), triage (NON-BLOCKING), storage_posture (NON-BLOCKING, optional), slo_check (NON-BLOCKING), security_audit (BLOCKING), conformance (BLOCKING), product_spine (BLOCKING, optional), routes_snapshot (BLOCKING), schema_snapshot (BLOCKING), error_contract (BLOCKING, inline), env_contract (BLOCKING, optional), auth_security (BLOCKING, optional), tenant_boundary (BLOCKING, optional), session_posture (BLOCKING), product_read_path (NON-BLOCKING, optional), observability_status (NON-BLOCKING, optional), rc0_gate (BLOCKING, optional). Row completeness guarantee: every check produces Check | Status | ExitCode | Notes row (blocking/non-blocking shown in Notes). Overall status calculation: FAIL if any blocking check FAILs, WARN if blocking SKIPs or non-blocking WARNs/FAILs, PASS otherwise. Created `ops/ops_drift_guard.ps1` to detect unwired ops scripts (compares ops/*.ps1 against registered checks in ops_status.ps1, FAILs if unwired scripts detected), verify runbook existence for registered checks, verify proof presence (WARN for missing proofs in non-blocking packs). Wired ops_drift_guard into ops_status as first BLOCKING check. Added `Write-OpsTableRow` helper to `ops/_lib/ops_output.ps1` for consistent ASCII-only table formatting. Updated `docs/RULES.md` with Rule 46 (All operational packs must be wired into ops_status or explicitly SKIP with documented reason) and Rule 47 (RC0 readiness = ops_status overall PASS, WARN allowed only if explicitly non-blocking). Updated `docs/runbooks/ops_status.md` with Decision Matrix (PASS/WARN/FAIL with blocking semantics) and "How to add a new pack" recipe (3 steps: add to registry, create runbook, create proof). Updated CI workflow to run drift guard before ops_status and upload incident bundle on FAIL. Created `docs/PROOFS/ops_central_governance_pass.md` with example outputs (drift guard PASS, ops_status table with blocking indicators, RC0 readiness decision matrix). No app code changes, no schema changes, PowerShell 5.1 compatible, ASCII-only output, safe exit pattern. All changes are minimal, localized, ops-only, and preserve existing behavior.
- **Product Spine Write-Path Skeleton Pack v1 (Contract-first write endpoints + zero drift + gates)**: Implemented Commerce listings write-path skeleton (POST/PATCH/DELETE) in `work/pazar/app/Http/Controllers/Api/Commerce/ListingController.php`. Write methods (store, update, destroy) enforce tenant boundary (tenant-scoped operations, 404 NOT_FOUND for cross-tenant access to prevent leakage), world boundary (commerce only, WORLD_CONTEXT_INVALID on mismatch), validation rules (title required for create, at least one mutable field for update), and deterministic response envelopes (201 Created for store with `{ok:true, data:{item:{...}, id:"uuid"}, request_id}`, 200 OK for update/delete with `{ok:true, data:{item:{...}} or {deleted:true}, request_id}`, 404 NOT_FOUND with `{ok:false, error_code:"NOT_FOUND", request_id}`, 422 VALIDATION_ERROR with `{ok:false, error_code:"VALIDATION_ERROR", request_id}`). Updated `work/pazar/routes/api.php` to add `resolve.tenant` and `tenant.user` middleware to write endpoints (same policy as read). Uses existing Listing model (no schema changes), validation via Validator facade (throws ValidationException for 422), no transactions or background jobs. Extended `ops/product_spine_check.ps1` with write endpoint runtime checks: POST without auth (401/403), POST with auth but missing tenant (403), POST with auth+tenant but invalid payload (422 VALIDATION_ERROR), PATCH non-existent id (404 NOT_FOUND), DELETE non-existent id (404 NOT_FOUND). Updated `docs/product/PRODUCT_API_SPINE.md` to mark Commerce write endpoints as IMPLEMENTED (Write-Path Skeleton v1) with request/response examples and error codes. Created `docs/PROOFS/product_write_path_pass.md` with example outputs (ASCII PASS/WARN/FAIL, curl examples with request_id for 422 and 404). Updated `docs/RULES.md` with Rule 45 (Product write-path changes require product_spine_check PASS/WARN + proof update). No schema changes, no refactors, minimal diff, preserves existing READ behavior. All changes are minimal, localized, RC0-safe, and preserve existing behavior.
- **Product Spine Governance Pack v1 (Self-auditing Product Read-Path gate + ops_status integration)**: Created `ops/product_spine_check.ps1` for self-auditing Product Read-Path governance (Commerce listings GET endpoints). Validates: (1) Route discovery: routes snapshot (`ops/snapshots/routes.pazar.json`) first, filesystem (`work/pazar/routes/api.php`) fallback. (2) Middleware policy (static): routes protected with `auth.any`, `resolve.tenant`, `tenant.user` (verified from snapshot if available). (3) Runtime contract: unauthorized GET returns 401/403 with JSON envelope (`ok:false`, `request_id` non-null), auth without tenant returns 403 with JSON envelope, auth + tenant returns 200 with `ok:true` and `request_id`, not found (404) returns `ok:false`, `error_code: "NOT_FOUND"`, `request_id` non-null. Parameters: `-BaseUrl` (default localhost:8080), `-TenantId`, `-AuthToken`, `-World` (default commerce). If services unreachable -> WARN (not FAIL), runtime checks skipped. If middleware policy violated (missing routes/middleware) -> FAIL. Uses `ops/_lib/ops_output.ps1` and `ops/_lib/ops_exit.ps1` for ASCII-only output and safe exit. Exit codes: 0 PASS, 2 WARN, 1 FAIL. Integrated into `ops/ops_status.ps1` as "Product Spine" check (after Conformance, before Routes/Schema snapshots). If script missing -> SKIP (status shown but does not fail). Created `docs/runbooks/product_spine.md` with what it checks, how to run, troubleshooting, incident workflow links. Updated `docs/RULES.md` with Rule 44 (Product spine changes require product_spine_check PASS/WARN and proof update). Created `docs/PROOFS/product_spine_governance_pass.md` with example outputs (ASCII PASS/WARN/FAIL, curl examples with request_id). No app code changes, PowerShell 5.1 compatible, ASCII-only output, safe exit pattern. All changes are minimal, localized, ops-only, and preserve existing behavior.
- **Product Read-Path Self-Audit Gate Pack v1 (Ops + CI, RC0-safe)**: Created `ops/product_read_path_check.ps1` for deterministic Product Read-Path validation (Commerce listings GET endpoints). Checks: (1) Route surface: unauthorized GET `/api/v1/commerce/listings` returns 401/403 with JSON error envelope (`ok:false`, `error_code`, `request_id` non-null). (2) Auth + tenant context: authenticated GET `/api/v1/commerce/listings` returns 200 with `ok:true`, `data.items` array, `request_id` non-null; authenticated GET `/api/v1/commerce/listings/{id}` for non-existent ID returns 404 with `ok:false`, `error_code: "NOT_FOUND"`, `request_id` non-null. (3) Content-Type validation: 200 responses must be `application/json` (not `text/html`). Uses PowerShell HTTP methods (`Invoke-WebRequest`) instead of curl for PS5.1 compatibility. Environment variables: `PRODUCT_TEST_TOKEN` (Bearer token) OR `PRODUCT_TEST_EMAIL` + `PRODUCT_TEST_PASSWORD` (login flow), `PRODUCT_TEST_TENANT_ID` (UUID). If credentials missing -> WARN (exit 2), authenticated checks skipped (not FAIL). Uses `ops/_lib/ops_output.ps1` and `ops/_lib/ops_exit.ps1` for ASCII-only output and safe exit. Exit codes: 0 PASS, 2 WARN, 1 FAIL. Integrated into `ops/ops_status.ps1` as "Product Read-Path" check (after session-posture). If script missing -> SKIP (status shown but does not fail). Created `docs/runbooks/product_read_path.md` with what it checks, env vars, interpretation, troubleshooting. Created `docs/PROOFS/product_read_path_gate_pass.md` with example outputs (WARN when env missing, PASS when env present). No app code changes, PowerShell 5.1 compatible, ASCII-only output, safe exit pattern. All changes are minimal, localized, ops-only, and preserve existing behavior.
- **Self-Audit Orchestrator + Drift Monitor Pack v1 (Non-stop governance, evidence trail, zero drift)**: Created `ops/self_audit.ps1` for deterministic self-audit orchestration (runs canonical checks in fixed order: doctor.ps1, run_ops_status.ps1, conformance.ps1, env_contract.ps1, security_audit.ps1, auth_security_check.ps1, tenant_boundary_check.ps1, session_posture_check.ps1, observability_status.ps1). Output folder: `_archive/audits/audit-YYYYMMDD-HHMMSS/` (untracked, gitignored). Produces meta.json (timestamp, git metadata, hostname, versions), summary.json (check results with overall status), per-check text files (doctor.txt, ops_status.txt, etc.). Exit codes: 0 PASS, 2 WARN, 1 FAIL. Created `ops/drift_monitor.ps1` for drift detection (compares current vs baseline audit, produces drift_report.md and drift_hashes.json). Drift detection covers governance surfaces: routes.pazar.json, schema.pazar.sql, WORLD_REGISTRY.md, config/worlds.php, RULES.md, ARCHITECTURE.md, REPO_LAYOUT.md, CHANGELOG.md, PRODUCT_API_SPINE.md, ops scripts (ops_status.ps1, self_audit.ps1, drift_monitor.ps1). Uses SHA256 file hashes for comparison. Created `docs/runbooks/self_audit.md` with usage guide, result interpretation, PR integration. Updated `.gitignore` to ignore `_archive/audits/`. Updated `ops/ops_status.ps1` with optional `-RecordAudit` switch (calls self_audit.ps1 at end, default behavior unchanged). Updated `docs/RULES.md` with Rule 43 (stability/security/ops changes require audit path and drift report). Updated `docs/PROOFS/cleanup_pass.md` with "SELF-AUDIT + DRIFT MONITOR PACK v1 PASS" section. No tracked artifacts, no app code changes, PowerShell 5.1 compatible, ASCII-only output, safe exit pattern. All changes are minimal, localized, ops-only, and preserve existing behavior.
- **RC0 Release Bundle + Cutover Pack v1 (One-command, reproducible, handover-ready)**: Created `ops/release_bundle.ps1` for one-command RC0 release bundle generation (15 artifacts: meta.txt with git metadata and Docker/Compose versions, ops_status.txt, doctor.txt, verify.txt, conformance.txt, env_contract.txt, security_audit.txt, tenant_boundary.txt, session_posture.txt, observability_status.txt, routes_snapshot.txt, schema_snapshot.txt, changelog_unreleased.txt, version.txt, README_cutover.md). Output folder: `_archive/releases/rc0-YYYYMMDD-HHMMSS/` (untracked, gitignored). Best-effort collection: Docker-dependent checks become WARN if Docker unavailable, collection continues. Safe exit: Uses `Invoke-OpsExit` pattern (does not close terminal). Exit code: 0 always unless folder creation fails. Created `docs/runbooks/rc0_release.md` with 10-step cutover checklist (verify git clean, stack_up, run_ops_status, generate release bundle, sanity endpoints, error contract confirmation, product read-path confirmation, tag guidance manual, rollback guidance, documentation update). Updated `docs/RULES.md` with Rule 44 (RC0 release requires bundle artifact path and rc0_release.md consulted). Updated `docs/PROOFS/cleanup_pass.md` with "RC0 RELEASE BUNDLE PACK v1 PASS" section (sample command, expected outputs, ASCII markers, bundle contents). Updated `ops/ops_status.ps1` with optional `-ReleaseBundle` switch (calls release_bundle.ps1 at end, default behavior unchanged). No tracked artifacts, no app code changes, PowerShell 5.1 compatible, ASCII-only output. All changes are minimal, localized, ops-only, and preserve existing behavior.
- **Product Read-Path Pack v1 (RC0 -> Product Dev Bridge)**: Implemented tenant-scoped read-path for commerce listings GET endpoints (index/show). Added minimal middleware: `AuthAny` (session or bearer token auth), `ResolveTenant` (X-Tenant-Id header or session), `EnsureTenantUser` (403 if tenant missing). Updated `Commerce ListingController` GET methods to query Listing model with tenant/world scope (forTenant + forWorld), cursor pagination (base64 encoded created_at:uuid), standard error envelope (500 TENANT_CONTEXT_MISSING, 400 WORLD_CONTEXT_INVALID, 404 NOT_FOUND). Updated routes: GET `/api/v1/commerce/listings` and `/api/v1/commerce/listings/{id}` now protected by `auth.any` + `resolve.tenant` + `tenant.user` middleware. Write endpoints (POST/PATCH/DELETE) remain 501 NOT_IMPLEMENTED. Food/Rentals endpoints unchanged (stub-only). Updated `PRODUCT_API_SPINE.md` with commerce GET implementation status. Created `docs/PROOFS/product_read_path_pass.md` with verification examples. RC0-safe: no disabled-world code, error contract preserved, security audit PASS, minimal diff, no schema changes, ops_status.ps1 usable. All changes are minimal, localized, RC0-safe, and preserve existing behavior.

### Added
- **Product API Spine Pack v1 (RC0-Safe)**: Established canonical Product API spine (contract-first, stub-only) for commerce listings. Added routes to `work/pazar/routes/api.php`: `/api/v1/commerce/listings` (GET, POST, GET/{id}, PATCH/{id}, DELETE/{id}), all protected by `auth.any` middleware. Created stub controller `work/pazar/app/Http/Controllers/Api/Commerce/ListingController.php` (all methods return 501 NOT_IMPLEMENTED with standard error envelope: `{ok: false, error_code: "NOT_IMPLEMENTED", message: "Commerce listings API is not implemented yet.", request_id: "<uuid>"}`, `X-Request-Id` header matches body request_id, `Content-Type: application/json`). Added contract tests `work/pazar/tests/Feature/Api/CommerceListingSpineTest.php`: unauthorized GET/POST return 401/403 with standard envelope and non-empty request_id, `X-Request-Id` header matches body request_id. Created API spine documentation `docs/product/PRODUCT_API_SPINE.md`: endpoints, auth requirement (auth.any), error envelope rules, stub phase rationale, explicit note "No DB schema changes in this pack". Updated `docs/PROOFS/cleanup_pass.md` with "PRODUCT API SPINE PACK v1 PASS" section (example curl outputs for unauthorized requests). RC0-safe: no DB schema changes, no breaking changes to existing routes, security audit remains PASS (routes protected by auth.any), routes snapshot includes new /api/v1 routes, zero architecture drift. All changes are minimal, localized, RC0-safe, and preserve existing behavior
- **Listings Core MVP Pack v1 (RC0-Safe)**: Implemented Listings Core MVP with CRUD + publish + public search for enabled worlds. Added database migration (`work/pazar/database/migrations/2026_01_10_000000_create_listings_table.php`) creating `listings` table with columns: id (uuid), tenant_id (uuid), world (string: commerce|food|rentals), title (string 120), description (text nullable), price_amount (bigint nullable), currency (string 3 default TRY), status (string 20 default draft: draft|published|archived), timestamps, indexes: (tenant_id, world, status), (tenant_id, status), (world, status), title. Added `Listing` model (`work/pazar/app/Models/Listing.php`) with UUID primary key, scopes: `published()`, `draft()`, `forTenant($tenantId)`, `forWorld($world)`, status constants. Added `ListingController` (`work/pazar/app/Http/Controllers/ListingController.php`) with public endpoints: `GET /api/{world}/listings/search` (published only), `GET /api/{world}/listings/{id}` (published only), panel endpoints (auth required: auth.any + tenant.user + resolve.tenant): `GET /api/{world}/panel/listings` (all statuses), `POST /api/{world}/panel/listings` (create), `PATCH /api/{world}/panel/listings/{id}` (update), `POST /api/{world}/panel/listings/{id}/publish` (draft -> published), `POST /api/{world}/panel/listings/{id}/unpublish` (published -> draft). Added validation: title (required, min:3, max:120), description (nullable, max:5000), price_amount (nullable, integer, min:0), currency (nullable, size:3, in:TRY,USD,EUR), world mismatch (400 WORLD_MISMATCH). Added tenant boundary enforcement via `forTenant($tenantId)` scope. Created API routes (`work/pazar/routes/api.php`) with public and panel routes, registered in `bootstrap/app.php`. Added feature tests (`work/pazar/tests/Feature/ListingCoreTest.php`): tenant boundary, publish flow, world mismatch, visibility. RC0-safe: no regression in RC0 gates (verify FS posture PASS, conformance world drift PASS, schema snapshot PASS, routes snapshot PASS), Control Center does not 500. Created proof document `docs/PROOFS/listings_core_mvp_pass.md`. All changes are minimal, localized, RC0-safe, and preserve existing behavior
- **Product World Spine MVP (RC0-Safe)**: Implemented World Spine MVP with enabled worlds routes and closed-world enforcement. Added `WorldResolver` middleware (`work/pazar/app/Http/Middleware/WorldResolver.php`) that determines world_id from route/URL, checks enable/disable status from `config/worlds.php`, returns HTTP 410 WORLD_CLOSED for disabled worlds (services, real_estate, vehicle), attaches world context (`ctx.world`) and adds `X-World` header for enabled worlds (commerce, food, rentals), returns HTTP 400/404 for missing/invalid world context (no default world). Added `WorldRegistry` service (`work/pazar/app/Worlds/WorldRegistry.php`) using `config/worlds.php` as source of truth. Added `WorldController` (`work/pazar/app/Http/Controllers/WorldController.php`) handling public routes for enabled worlds (`home()` and `search()` methods). Created routes (`work/pazar/routes/web.php`): `GET /worlds/{world}` (home page), `GET /worlds/{world}/search` (placeholder). Added minimal views (`work/pazar/resources/views/worlds/home.blade.php`, `closed.blade.php`) for world home pages and closed-world page. Updated `AdminControlCenterController` to include enabled worlds list for World Links section. Added feature tests (`work/pazar/tests/Feature/WorldSpineTest.php`) validating 200/410/400 responses and X-World header. Registered `world.resolve` middleware alias in `bootstrap/app.php`. RC0-safe: no regression in RC0 gates (verify FS posture PASS, conformance world drift PASS), Control Center does not 500, no disabled world code footprint (strictly closed). Created proof document `docs/PROOFS/product_world_spine_pass.md`. All changes are minimal, localized, RC0-safe, and preserve existing behavior
- **RC0 Hard Blockers Fix v1 (Permissions + World Registry Drift + Trusted RC0 Gate + Obs Warn Semantics)**: Fixed UI 500 errors due to permission denied on `/var/www/html/storage/logs/laravel.log` by adding `pazar-perms-init` one-shot service to `docker-compose.yml` (runs before pazar-app starts, fixes permissions on named volumes with root user), updated `pazar-app` depends_on to wait for `pazar-perms-init: condition: service_completed_successfully`. Fixed world registry drift check (conformance A) by adding parseable list format to `work/pazar/WORLD_REGISTRY.md` (under "### Enabled Worlds" and "### Disabled Worlds"), enhanced `ops/conformance.ps1` parsing logic to extract from "- key" lines under sections, clear drift messages: "enabled extra/missing, disabled extra/missing". Enhanced `ops/rc0_gate.ps1` trusted output: added empty results check (if no check results collected, gate FAILs with "No check results collected - gate error"), summary is never empty, FAIL triggers incident bundle generation. Enhanced observability status Rule 34 compliance: connection refused/timeout (exit code 7/28) -> WARN (obs not available), real config/rules/targets errors -> FAIL, services not running but accessible -> WARN. Updated `docs/runbooks/incident.md` with "UI 500: laravel.log Permission Denied Troubleshooting" section (one-shot init service fix). Created proof document `docs/PROOFS/rc0_pass.md` with UI 500 fix evidence, world registry drift PASS example, RC0 gate trusted output examples, observability Rule 34 examples. Added Rule 40 to `docs/RULES.md`: RC0 gate cannot produce empty summary, PASS/WARN/FAIL counts are mandatory. All changes are minimal diff, backward compatible, PowerShell 5.1 compatible, ASCII-only output, safe-exit pattern preserved
- **RC0 Pazar Storage Permissions Fix**: Fixed UI 500 errors due to permission denied on `/var/www/html/storage/logs/laravel.log` by adding `user: "0:0"` to `docker-compose.yml` pazar-app service (allows entrypoint to run as root for chown operations), enhanced `work/pazar/docker/docker-entrypoint.sh` with root check (if root: mkdir, chown, chmod; if not root: WARN log), added Pazar FS posture check to `ops/verify.ps1` (Step 4: verifies storage/logs writability via `docker compose exec -T pazar-app sh -lc 'test -d storage/logs && touch storage/logs/laravel.log && test -w storage/logs/laravel.log'`), uses ops_output.ps1 and ops_exit.ps1 helpers for ASCII-only output and safe exit, includes remediation hint on FAIL. Created proof document `docs/PROOFS/rc0_pazar_storage_permissions_pass.md` with before/after UI 500 error description, verify.ps1 check PASS evidence, docker compose ps output, and request_id trace reference. All changes are minimal diff, backward compatible, PowerShell 5.1 compatible
- **RC0 Finalization Pack v1 (Truthful Gate + Drift Zero)**: Fixed RC0 gate null crash bug where `tenantBoundaryResult.Notes.ToLower()` could crash if result was null or Notes was missing, ensuring null-safe access with `if ($null -ne $tenantBoundaryResult.Notes) { [string]$tenantBoundaryResult.Notes } else { "" }` (PS 5.1 compatible, no null-coalescing operator). Enhanced RC0 gate to properly aggregate exit codes: any check FAIL => overall FAIL, any internal exception => overall FAIL (not PASS), missing checks => FAIL with explicit "SKIPPED due to error" notes. Fixed world registry drift by ensuring `work/pazar/WORLD_REGISTRY.md` matches `work/pazar/config/worlds.php` exactly (enabled: commerce, food, rentals; disabled: services, real_estate, vehicle). Fixed schema snapshot drift by adding normalization patterns for pg_dump metadata noise (`\restrict` and `\unrestrict` lines with random strings), ensuring deterministic schema comparison. Made Pazar /up endpoint required for RC0 mode via `ops/verify.ps1 -Release` switch or `$env:RC0=1` env var, while keeping default (non-RC0) behavior backward compatible (optional /up). Added Rule 39 to `docs/RULES.md` enforcing RC0 gate truthful policy: NO PASS if any check FAILs or collection crashes, RC0 requires /up PASS. Created proof documents: `docs/PROOFS/rc0_truthful_gate_pass.md`, `docs/PROOFS/world_registry_drift_fix.md`, `docs/PROOFS/db_contract_pass.md`. All changes are PowerShell 5.1 compatible, ASCII-only output, safe-exit pattern preserved
- **RC0 Gate v1 (Single Truth + Reliable Gate)**: Fixed world registry drift check (conformance A) by creating `work/pazar/WORLD_REGISTRY.md` and `work/pazar/config/worlds.php` as single source of truth, fixed PowerShell 5.1 ParseException in `ops/release_bundle.ps1` (colon-separated variable references), enhanced `ops/rc0_gate.ps1` with 13 comprehensive checks (added routes snapshot, schema snapshot, release bundle), implemented reliable decision logic with real count filtering (no false "0/0/0" summaries), added proper non-blocking check mapping (SLO FAIL → WARN, routes_snapshot real FAIL stays FAIL), updated `docs/runbooks/rc0_gate.md` and created `docs/PROOFS/rc0_gate_pass.md` with sample outputs, and ensured all changes are ops + docs + governance only (no app code changes)
- **RC0 Gate v1 (Single Truth + Reliable Gate)**: Fixed world registry drift check (conformance A) by creating `work/pazar/WORLD_REGISTRY.md` and `work/pazar/config/worlds.php` as single source of truth, fixed PowerShell 5.1 ParseException in `ops/release_bundle.ps1` (colon-separated variable references), enhanced `ops/rc0_gate.ps1` with 13 comprehensive checks (added routes snapshot, schema snapshot, release bundle), implemented reliable decision logic with real count filtering (no false "0/0/0" summaries), added proper non-blocking check mapping (SLO FAIL → WARN, routes_snapshot real FAIL stays FAIL), updated `docs/runbooks/rc0_gate.md` and created `docs/PROOFS/rc0_gate_pass.md` with sample outputs, and ensured all changes are ops + docs + governance only (no app code changes)
- **RC0 Release Pack v1**: Created `ops/release_check.ps1` for RC0 release checklist enforcement (git status, RC0 gate, required docs, snapshots, VERSION validation), created `ops/release_bundle.ps1` for portable release evidence folder generation, added `.github/workflows/release-check.yml` CI workflow for automated release validation, created `docs/ops/VERSIONING.md` versioning policy document, created comprehensive `docs/runbooks/release.md` runbook with RC0 release sequence, added Rule 38 to `docs/RULES.md` requiring release_check PASS/WARN + bundle attached, and added proof documentation section to `docs/PROOFS/cleanup_pass.md`
- **RC0 Gate Pack v1**: Created `ops/rc0_gate.ps1` as single-command RC0 readiness check, integrated into `ops/ops_status.ps1` as optional check, added `.github/workflows/rc0-gate.yml` CI workflow for automated RC0 validation, created comprehensive `docs/runbooks/rc0_gate.md` runbook with remediation guidance, added Rule 37 to `docs/RULES.md` requiring RC0 gate PASS/WARN before RC0 tag, and added proof documentation section to `docs/PROOFS/cleanup_pass.md`
- **Ops Safe Exit + PS5.1 Hardening Pack v1**: Added `ops/_lib/ops_exit.ps1` safe exit helper to prevent terminal closure in interactive PowerShell sessions while preserving exit codes in CI, replaced all hard exits with `Invoke-OpsExit` in `ops_status.ps1`, `doctor.ps1`, `verify.ps1`, `triage.ps1`, `conformance.ps1`, and `schema_snapshot.ps1`, fixed PowerShell 5.1 HashSet constructor overload issues in conformance and schema_snapshot scripts, fixed schema normalize function to use single-line regex patterns (prevents "Dumped is not recognized" error), and updated runbook documentation
- **Storage Writability + Alert Pipeline Proof Pack v1**: Enhanced `docker-entrypoint.sh` with robust permission enforcement and writability probe (fail-fast behavior), created `ops/storage_posture_check.ps1` for automated storage verification, added webhook `/last` endpoint to `alert-webhook` service for alert payload retrieval, created `ops/alert_pipeline_proof.ps1` for deterministic Alertmanager -> Webhook pipeline verification, and added comprehensive runbooks and proof documentation
- **Laravel Log Permission Hotfix Pack v1**: Fixed Laravel Monolog permission denied errors for `/var/www/html/storage/logs/laravel.log` by creating `supervisord.conf` (required by Dockerfile), ensuring named volumes are used for runtime-writable directories, and adding deterministic remediation steps to incident runbook
- **Release-Grade Foundation Pack v1**: Pazar storage hardening (named volumes for runtime-writable directories, idempotent permission enforcement), observability safe bring-up (no port conflicts with core), repo integrity check script (`ops/repo_integrity.ps1`), and comprehensive proof documentation
- **World Spine Governance Pack v1**: Added world spine governance check to ensure enabled worlds have route/controller surfaces and ctx.world lock evidence, while disabled worlds don't have leftover controller code

### Added
- Architecture conformance gate: `ops/conformance.ps1` and `.github/workflows/conformance.yml` for automated architecture rule validation (world registry drift, forbidden artifacts, disabled-world code policy, canonical docs, secrets safety)
- Contract gate via route snapshot: `ops/routes_snapshot.ps1`, `ops/snapshots/routes.pazar.json`, and `.github/workflows/contracts.yml` for API contract validation (route signature comparison, diff generation on change)
- DB contract gate via schema snapshot: `ops/schema_snapshot.ps1`, `ops/snapshots/schema.pazar.sql`, and `.github/workflows/db-contracts.yml` for database schema validation (Postgres schema export, normalization, diff generation on change)
- Observability pack v1: Request ID middleware with structured logging context (service, route, method, request_id, tenant_id, user_id, world), X-Request-Id header propagation to H-OS API calls, request_id in outbox event payload, and observability runbook
- Error contract pack v1: Standard error envelope in global exception handler ({ ok:false, error_code, message, request_id, details? }), error code mapping (VALIDATION_ERROR, NOT_FOUND, UNAUTHORIZED, FORBIDDEN, INTERNAL_ERROR), structured error logging (event, error_code, request_id, route, method, world, user_id, exception_class), and error runbook
- Error contract CI gate: `.github/workflows/error-contract.yml` for automated validation of error response envelope format (422 VALIDATION_ERROR with details.fields, 404 NOT_FOUND with request_id)
- Incident pack v1: `docs/runbooks/incident.md` runbook with SEV definitions, triage checklist, request_id workflow, and CI gate troubleshooting
- Triage script: `ops/triage.ps1` for single-command health checks and log inspection
- Repo standardization v1: `docs/ARCHITECTURE.md` (architecture overview), `docs/REPO_LAYOUT.md` (layout contract), `ops/doctor.ps1` (repository health check), expanded CODEOWNERS for docs/ops/workflows
- Incident bundle v1: `ops/incident_bundle.ps1` (evidence collection tool), `docs/runbooks/incident_bundle.md` (bundle generator runbook)
- SLO pack v1: `docs/ops/SLO.md` (SLO definitions), `docs/ops/ERROR_BUDGET.md` (error budget policy), `docs/runbooks/slo_breach.md` (breach response), `ops/slo_check.ps1` (lightweight SLO benchmark)
- Performance baseline v1: `ops/perf_baseline.ps1` (warm-up + first-hit analysis), `docs/ops/PERFORMANCE_BASELINE.md` (performance baseline methodology), updated `ops/slo_check.ps1` with warm-up phase
- SLO policy hardening v1: Made p50 latency non-blocking in release decisions, added blocking vs non-blocking metric classification, updated error budget and breach runbooks
- Environment & secrets contract pack v1: Added `ops/env_contract.ps1` and `.github/workflows/env-contract.yml` for validating required environment variables and production guardrails (CORS policy, session security)
- Identity & session posture pack v1: Added `ops/session_posture_check.ps1` and `.github/workflows/session-posture.yml` for validating session cookie security flags (Secure, HttpOnly, SameSite) and auth endpoint security posture (JSON envelope, security headers, rate limit headers)
- Request trace pack v1: Added `ops/request_trace.ps1` for correlating Pazar and H-OS logs by request_id, integrated into `ops/triage.ps1` with optional RequestId parameter, and updated incident runbook with request trace step

### Changed
- Cleanup HIGH risk unused code: archived 3 empty World controller directories (`RealEstate/`, `Services/`, `Vehicles/`) to `_archive/20260108/cleanup_high/` (disabled worlds, no routes, no controllers)

## [0.1.0] - 2026-01-08

### Added
- Secrets lock: `.gitignore` entries for secrets and runtime artifacts
- Onboarding documentation: `docs/START_HERE.md` and `docs/RULES.md`
- Repo guard workflow: `.github/workflows/repo-guard.yml` (anti-drift protection)
- Smoke workflow: `.github/workflows/smoke.yml` (CI health checks)
- CODEOWNERS protection: `.github/CODEOWNERS` for critical paths
- Verification script: `ops/verify.ps1` for stack health checks
- Release discipline: `VERSION`, `CHANGELOG.md`, `docs/RELEASE_CHECKLIST.md`

### Fixed
- Laravel storage permissions: `docker-entrypoint.sh` fixes `www-data` ownership on container start
- OIDC login UX: form pre-fill and Docker session fallback

### Changed
- Cleanup LOW risk artifacts: moved to `_archive/20260108/cleanup_low/`
- Documentation structure: added proof tracking in `docs/PROOFS/cleanup_pass.md`

[Unreleased]: https://github.com/bekiryara/stack/compare/v0.1.0...HEAD
[0.1.0]: https://github.com/bekiryara/stack/releases/tag/v0.1.0


